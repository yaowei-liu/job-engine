<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Job Engine</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body class="text-slate-900 min-h-screen p-4 md:p-6">
  <div class="max-w-7xl mx-auto">
    <header class="mb-6 flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
      <div>
        <h1 class="text-3xl font-semibold tracking-tight">Job Engine</h1>
        <p class="text-sm text-slate-600">Workflow mode: clear Inbox first, then process Approved to Applied. Shortcuts: J/K move, A approve, S skip, L applied.</p>
      </div>
      <div class="flex items-center gap-2">
        <label class="text-xs text-slate-600 inline-flex items-center gap-1">
          LLM mode
          <select id="llm-mode" class="px-2 py-1 rounded-md border border-slate-200 text-xs bg-white">
            <option value="auto" selected>Auto</option>
            <option value="realtime">Force realtime</option>
            <option value="batch">Force batch</option>
          </select>
        </label>
        <button id="run-scan" class="px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white font-medium">Run Ingestion</button>
        <button id="cleanup-inbox" class="px-4 py-2 rounded-lg bg-amber-600 hover:bg-amber-700 text-white font-medium">Cleanup Inbox</button>
        <button id="refresh" class="px-4 py-2 rounded-lg bg-sky-600 hover:bg-sky-700 text-white font-medium">Refresh</button>
      </div>
    </header>

    <section class="mb-5 grid gap-3 md:grid-cols-3">
      <div class="bg-white/95 border border-slate-200 rounded-xl p-4 shadow-sm md:col-span-2">
        <div class="flex items-center justify-between">
          <h2 class="font-semibold">Latest Ingestion Run</h2>
          <span id="run-status" class="text-xs px-2 py-1 rounded-full bg-slate-100 text-slate-700">No data</span>
        </div>
        <p id="run-summary" class="text-sm text-slate-600 mt-2">Waiting for run data...</p>
        <div id="llm-progress" class="mt-3">
          <div class="flex items-center justify-between text-xs text-slate-600">
            <span class="font-medium">LLM processing</span>
            <span id="llm-progress-meta">0%</span>
          </div>
          <div class="mt-1 h-2 w-full rounded-full bg-slate-200 overflow-hidden">
            <div id="llm-progress-bar" class="h-full bg-emerald-500 transition-all duration-300" style="width: 0%"></div>
          </div>
          <p id="llm-progress-detail" class="mt-1 text-xs text-slate-500">No active run.</p>
        </div>
        <p id="run-errors" class="text-xs text-rose-600 mt-1"></p>
      </div>
      <div class="bg-white/95 border border-slate-200 rounded-xl p-4 shadow-sm">
        <h2 class="font-semibold">Queue Stats</h2>
        <p id="stats" class="text-sm text-slate-600 mt-2">0 jobs</p>
        <p id="page-stats" class="text-xs text-slate-500 mt-1">Page 1</p>
        <p id="stage-summary" class="text-xs text-teal-700 mt-1">Viewing inbox</p>
      </div>
    </section>

    <section class="bg-white/95 border border-slate-200 rounded-xl p-4 shadow-sm mb-4">
      <div class="flex flex-wrap items-center gap-2">
        <button data-stage="inbox" class="stage-btn stage-chip-active px-3 py-1.5 rounded-full border border-slate-200 text-sm font-medium">
          Inbox <span id="count-inbox" class="ml-1 text-xs opacity-90">0</span>
        </button>
        <button data-stage="approved" class="stage-btn px-3 py-1.5 rounded-full border border-slate-200 bg-white text-slate-700 text-sm font-medium">
          Approved <span id="count-approved" class="ml-1 text-xs opacity-75">0</span>
        </button>
        <button data-stage="applied" class="stage-btn px-3 py-1.5 rounded-full border border-slate-200 bg-white text-slate-700 text-sm font-medium">
          Applied <span id="count-applied" class="ml-1 text-xs opacity-75">0</span>
        </button>
        <button data-stage="archive" class="stage-btn px-3 py-1.5 rounded-full border border-slate-200 bg-white text-slate-500 text-sm font-medium">
          Archive (Skipped) <span id="count-archive" class="ml-1 text-xs opacity-75">0</span>
        </button>
      </div>
      <div class="grid gap-3 md:grid-cols-7 mt-3">
        <input id="q" placeholder="Search company or title" class="md:col-span-2 px-3 py-2 rounded-lg border border-slate-200 text-sm" />
        <select id="tier" class="px-3 py-2 rounded-lg border border-slate-200 text-sm">
          <option value="">All tiers</option>
          <option value="A">Tier A</option>
          <option value="B">Tier B</option>
          <option value="C">Tier C</option>
        </select>
        <select id="source" class="px-3 py-2 rounded-lg border border-slate-200 text-sm">
          <option value="">All sources</option>
          <option value="greenhouse">Greenhouse</option>
          <option value="lever">Lever</option>
          <option value="serpapi">SerpAPI</option>
          <option value="amazon">Amazon</option>
          <option value="ashby">Ashby</option>
          <option value="workday">Workday</option>
        </select>
        <select id="sort" class="px-3 py-2 rounded-lg border border-slate-200 text-sm">
          <option value="newest">Newest</option>
          <option value="score">Top score</option>
          <option value="company">Company A-Z</option>
          <option value="oldest">Oldest</option>
        </select>
        <input id="minScore" type="number" placeholder="Min score" class="px-3 py-2 rounded-lg border border-slate-200 text-sm" />
        <select id="seenWithinDays" class="px-3 py-2 rounded-lg border border-slate-200 text-sm">
          <option value="">Seen anytime</option>
          <option value="1">Seen in 1 day</option>
          <option value="7">Seen in 7 days</option>
          <option value="30">Seen in 30 days</option>
        </select>
      </div>
      <div class="flex flex-wrap items-center gap-4 mt-3">
        <label class="text-sm text-slate-700 inline-flex items-center gap-2">
          <input id="bigtech" type="checkbox" class="rounded" /> Big Tech only
        </label>
        <label class="text-sm text-slate-700 inline-flex items-center gap-2">
          <input id="hasErrors" type="checkbox" class="rounded" /> Show sync errors
        </label>
      </div>
    </section>

    <div id="error-banner" class="hidden mb-4 bg-rose-50 border border-rose-200 text-rose-700 rounded-lg px-4 py-2 text-sm"></div>
    <div id="loading" class="hidden mb-4 text-sm text-slate-600">Loading jobs...</div>
    <div id="empty" class="hidden mb-4 text-sm text-slate-600 bg-white border border-slate-200 rounded-lg p-4">No jobs match current stage and filters.</div>

    <div id="list" class="space-y-3"></div>

    <div class="mt-5 flex items-center justify-between bg-white/95 border border-slate-200 rounded-xl p-3 shadow-sm">
      <button id="prev-page" class="px-3 py-1.5 rounded-md border border-slate-300 text-sm disabled:opacity-40">Previous</button>
      <span id="pagination" class="text-sm text-slate-600">Page 1</span>
      <button id="next-page" class="px-3 py-1.5 rounded-md border border-slate-300 text-sm disabled:opacity-40">Next</button>
    </div>

    <section id="provenance" class="mt-6 hidden bg-white/95 border border-slate-200 rounded-xl p-4 shadow-sm">
      <div class="flex items-center justify-between">
        <h2 class="font-semibold">Selected Job Provenance</h2>
        <button id="close-provenance" class="text-sm text-slate-500 hover:text-slate-700">Close</button>
      </div>
      <pre id="provenance-content" class="mt-3 text-xs bg-slate-50 border border-slate-200 rounded-lg p-3 overflow-auto"></pre>
    </section>
  </div>

  <div id="undo-toast" class="undo-toast bg-slate-900 text-white rounded-xl shadow-xl p-3">
    <p id="undo-text" class="text-sm">Action completed</p>
    <div class="mt-2 flex items-center justify-between">
      <span id="undo-countdown" class="text-xs text-slate-300">Undo available for 8s</span>
      <button id="undo-btn" class="px-2.5 py-1 rounded-md bg-white text-slate-900 text-xs font-semibold">Undo</button>
    </div>
  </div>

  <script type="module" src="/app.js"></script>
</body>
</html>
